---

title: Exporting Code and Docstrings


keywords: fastai
sidebar: home_sidebar

summary: "Converts `docment` docstrings to Numpy styled"
description: "Converts `docment` docstrings to Numpy styled"
nb_path: "00_docstring.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_docstring.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/mnt/d/jupyter/anaconda3/envs/nbagile/lib/python3.7/site-packages/fastprogress/fastprogress.py:102: UserWarning: Couldn&#39;t import ipywidgets properly, progress bar will use console behavior
  warn(&#34;Couldn&#39;t import ipywidgets properly, progress bar will use console behavior&#34;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The goal of this module is to take code that looks like the following:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">addition</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="c1"># The first number to add</span>
    <span class="n">b</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># The second number to add</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="c1"># The sum of a and b</span>
    <span class="s2">&quot;Adds two numbers together&quot;</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And convert it to be the following:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">addition</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Adds two numbers together</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    a : int</span>
<span class="sd">        The first number to add</span>
<span class="sd">    b : int</span>
<span class="sd">        The second number to add</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The sum of a and b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Documentation-Strings">Documentation Strings<a class="anchor-link" href="#Documentation-Strings"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Below we have an example string repsentation of the above docments style:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;def addition(</span>
<span class="s1">    a:(int, float), # The first number to add</span>
<span class="s1">    # The second number to add</span>
<span class="s1">    b:int = 2,</span>
<span class="s1">) -&gt; (int,float): # The sum of a and b</span>
<span class="s1">    &quot;Adds two numbers together&quot;</span>
<span class="s1">    return a+b&#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_annotations" class="doc_header"><code>get_annotations</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_annotations</code>(<strong><code>source</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Extracts the type annotations from source code</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>source : str
  Source code of function or class</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>source</code></strong> : <em><code>str</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">get_annotations</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="p">([</span><span class="s1">&#39;(int, float)&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">],</span> <span class="s1">&#39;(int, float)&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">_get_leading</span><span class="p">(</span><span class="s1">&#39;  Hello my name is Zach&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="apply" class="doc_header"><code>apply</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>apply</code>(<strong><code>func</code></strong>:<code>callable</code>, <strong><code>x</code></strong>:<code>any</code>, <strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Apply <code>func</code> recursively to <code>x</code>, passing on args. Originally from fastai.torch_core</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>func : callable
  A callable function
x : any
  Something to apply <code>func</code> on</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>func</code></strong> : <em><code>callable</code></em></p>
</li>
<li><p><strong><code>x</code></strong> : <em><code>any</code></em></p>
</li>
<li><p><strong><code>args</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reformat_function" class="doc_header"><code>reformat_function</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L64" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reformat_function</code>(<strong><code>source</code></strong>:<code>str</code>)</p>
</blockquote>
<p>Takes messy source code and refactors it into a readable PEP-8 standard style</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>source : str
  Source code</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>source</code></strong> : <em><code>str</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;@delegates()</span>
<span class="s2">def addition(</span>
<span class="s2">    a:(int, float), # The first number to add</span>
<span class="s2">    # The second number to add</span>
<span class="s2">    b:int = 2,</span>
<span class="s2">) -&gt; (int,float): # The sum of a and b</span>
<span class="s2">    &quot;Adds two numbers together&quot;</span>
<span class="s2">    def _inner(): return a+b</span>
<span class="s2">    return _inner()&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>@delegates()
def addition(
    a:(int, float), # The first number to add
    # The second number to add
    b:int = 2,
) -&gt; (int,float): # The sum of a and b
    &#34;Adds two numbers together&#34;
    def _inner(): return a+b
    return _inner()
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">reformat_function</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>@delegates()
def addition(a:(int, float), b:int=2):
    &#34;&#34;&#34;Adds two numbers together

    Parameters
    ----------
    a : (int, float)
      The first number to add
    b : int
      The second number to add

    Returns
    -------
    (int, float)
      The sum of a and b
    &#34;&#34;&#34;

    def _inner():
        return (a + b)
    return _inner()

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reformat_class" class="doc_header"><code>reformat_class</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L131" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reformat_class</code>(<strong><code>source</code></strong>:<code>str</code>, <strong><code>recursion_level</code></strong>:<code>int</code>=<em><code>1</code></em>)</p>
</blockquote>
<p>Takes messy class code and refactors it into a readable PEP-8 standard style</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>source : str
  Source code of a full class
recursion_level : int
  Depth of recursion</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>source</code></strong> : <em><code>str</code></em></p>
</li>
<li><p><strong><code>recursion_level</code></strong> : <em><code>int</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;class Arithmetic:</span>
<span class="s1">    &quot;A class that can perform basic arithmetic on ops&quot;</span>
<span class="s1">    _o = 2</span>
<span class="s1">    _b = 5</span>
<span class="s1">    </span>
<span class="s1">    _c = 3</span>
<span class="s1">    </span>
<span class="s1">    class A:</span>
<span class="s1">        def __init__(</span>
<span class="s1">          self, </span>
<span class="s1">          o:int # An integer</span>
<span class="s1">        ):</span>
<span class="s1">            self.o = o</span>
<span class="s1">    </span>
<span class="s1">    def __init__(</span>
<span class="s1">        self,</span>
<span class="s1">        a:int, # The first number to use</span>
<span class="s1">        b:(int, float), # The second number to use</span>
<span class="s1">    ):</span>
<span class="s1">        self.a = a</span>
<span class="s1">        self.b = b</span>
<span class="s1">        </span>
<span class="s1">    @delegates()</span>
<span class="s1">    def add(</span>
<span class="s1">        self</span>
<span class="s1">    ) -&gt; (int,float): # Sum of a and b</span>
<span class="s1">        &quot;Adds self.a and self.b&quot;</span>
<span class="s1">        return self.a + self.b&#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">reformat_class</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>class Arithmetic():
    &#34;&#34;&#34;A class that can perform basic arithmetic on ops&#34;&#34;&#34;
    _o = 2
    _b = 5
    _c = 3
    class A():
        def __init__(self, o:int):
            &#34;&#34;&#34;
            Parameters
            ----------
            o : int
              An integer
            &#34;&#34;&#34;
            self.o = o
        
    def __init__(self, a:int, b:(int, float)):
        &#34;&#34;&#34;
        Parameters
        ----------
        a : int
          The first number to use
        b : (int, float)
          The second number to use
        &#34;&#34;&#34;
        self.a = a
        self.b = b
    
    @delegates()
    def add(self):
        &#34;&#34;&#34;Adds self.a and self.b
    
        Returns
        -------
        (int, float)
          Sum of a and b
        &#34;&#34;&#34;
        return (self.a + self.b)
    
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">multiple_funcs</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;from fastai.vision.all import *</span>

<span class="s1">import numpy as np</span>

<span class="s1">class Arithmetic:</span>
<span class="s1">    &quot;A class that can perform basic arithmetic on ops&quot;</span>
<span class="s1">    _o = 2</span>
<span class="s1">    _b = 5</span>
<span class="s1">    </span>
<span class="s1">    _c = 3</span>
<span class="s1">    </span>
<span class="s1">    class A:</span>
<span class="s1">        def __init__(</span>
<span class="s1">          self, </span>
<span class="s1">          o:int # An integer</span>
<span class="s1">        ):</span>
<span class="s1">            self.o = o</span>
<span class="s1">    </span>
<span class="s1">    def __init__(</span>
<span class="s1">        self,</span>
<span class="s1">        a:int, # The first number to use</span>
<span class="s1">        b:(int, float), # The second number to use</span>
<span class="s1">    ):</span>
<span class="s1">        self.a = a</span>
<span class="s1">        self.b = b</span>
<span class="s1">        </span>
<span class="s1">    @delegates()</span>
<span class="s1">    def add(</span>
<span class="s1">        self</span>
<span class="s1">    ) -&gt; (int,float): # Sum of a and b</span>
<span class="s1">        &quot;Adds self.a and self.b&quot;</span>
<span class="s1">        return self.a + self.b</span>

<span class="s1">def foo(</span>
<span class="s1">    a:int, # First</span>
<span class="s1">    b:int, # Second</span>
<span class="s1">) -&gt; (int, float): # Sum of a and b</span>
<span class="s1">    &quot;Adds&quot;</span>
<span class="s1">    return a+b</span>
<span class="s1">    </span>
<span class="s1">def baz(</span>
<span class="s1">    a:int, # First</span>
<span class="s1">    b:int, # Second</span>
<span class="s1">) -&gt; (int, float): # Difference of a and b</span>
<span class="s1">    &quot;Subtracts&quot;</span>
<span class="s1">    return a-b</span>
<span class="s1">    </span>
<span class="s1">myConst = 22</span>

<span class="s1">def bar(</span>
<span class="s1">    a:int, # First</span>
<span class="s1">    b:int, # Second</span>
<span class="s1">) -&gt; (int, float): # Product of a and b</span>
<span class="s1">    &quot;Multiplies&quot;</span>
<span class="s1">    return a*b&#39;&#39;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cleaning-and-Transforming-Files">Cleaning and Transforming Files<a class="anchor-link" href="#Cleaning-and-Transforming-Files"> </a></h2><p>Given the above's usage of AST trees to rebuild your code, it automatically looks very similar to something that would come out of a code formatter, such as Black or Flake8. However, we still need to convert individual files, not just handling certain capabilities.</p>
<p>This is what the below functionality does</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clean_file" class="doc_header"><code>clean_file</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L232" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clean_file</code>(<strong><code>fname</code></strong>:<code>(Path, str)</code>, <strong><code>use_all</code></strong>:<code>bool</code>)</p>
</blockquote>
<p>Cleans an individual file from docment-style annotation to numpy-style</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>fname : (Path, str)
  The location of a filename to clean
use_all : bool
  Whether to add a '<strong>all</strong>' to the file</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>fname</code></strong> : <em><code>(Path, str)</code></em></p>
</li>
<li><p><strong><code>use_all</code></strong> : <em><code>bool</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nbagile_build_lib" class="doc_header"><code>nbagile_build_lib</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L299" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nbagile_build_lib</code>()</p>
</blockquote>
<p>Export notebooks matching <code>fname</code> to python modules</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nbagile_diff_nbs" class="doc_header"><code>nbagile_diff_nbs</code><a href="https://github.com/muellerzr/nbagile/tree/master/nbagile/docstring.py#L318" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nbagile_diff_nbs</code>()</p>
</blockquote>
<p>Prints the diff between an export of the library in notebooks and the actual modules</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

